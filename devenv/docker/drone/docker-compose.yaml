version: '2'

services:
  docker-puppeteer:
    image: grafana/docker-puppeteer:pre-node-20@sha256:77451c4522c5a7bb00aad3fe9fa61eceef208306a9146caee7b6dc4a20cf261c
    volumes:
      - "../../..:/drone/src"
    stdin_open: true # docker run -i
    tty: true        # docker run -t
    entrypoint: bash
  grafana:
    image: grafana/grafana-enterprise:latest@sha256:1d6b24fd4121d97bde0dea8aa19a357306a48dbfb7f61303649c4b6db5d327b7
    ports:
      - 3000:3000
    environment:
      GF_FEATURE_TOGGLES_ENABLE: renderAuthJWT
    volumes:
      - ../test/dashboards.yaml:/etc/grafana/provisioning/dashboards/dashboards.yaml
      - ../../../scripts/drone/provisioning/dashboards:/usr/share/grafana/dashboards
      - ../../../scripts/drone/provisioning/datasources/datasources.yaml:/etc/grafana/provisioning/datasources/datasources.yaml
